name: Release to production

on:
  push:
    tags:
      - 'v*'

jobs:
  build_linux:
    name: Build
    uses: ./.github/workflows/build_one.yml
    with:
      godot-export-preset: linux

  release_linux:
    needs: [build_linux]
    name: Release
    uses: ./.github/workflows/release_one.yml
    with:
      release-channel: linux-production
      artifact-name: ${{ needs.build_linux.outputs.artifact-name }}
    secrets: inherit

  build_mac:
    name: Build
    uses: ./.github/workflows/build_one.yml
    with:
      godot-export-preset: mac

  release_mac:
    needs: [build_mac]
    name: Release
    uses: ./.github/workflows/release_one.yml
    with:
      release-channel: mac-production
      artifact-name: ${{ needs.build_mac.outputs.artifact-name }}
    secrets: inherit

  build_web:
    name: Build
    uses: ./.github/workflows/build_one.yml
    with:
      godot-export-preset: web

  release_web:
    needs: [build_web]
    name: Release
    uses: ./.github/workflows/release_one.yml
    with:
      release-channel: web-production
      artifact-name: ${{ needs.build_web.outputs.artifact-name }}
    secrets: inherit

  build_windows:
    name: Build
    uses: ./.github/workflows/build_one.yml
    with:
      godot-export-preset: windows

  release_windows:
    needs: [build_windows]
    name: Release
    uses: ./.github/workflows/release_one.yml
    with:
      release-channel: windows-production
      artifact-name: ${{ needs.build_web.outputs.artifact-name }}
    secrets: inherit
